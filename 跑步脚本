-- 猫帝SPEED - 慢速加速脚步脚本
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

-- 获取本地玩家
local localPlayer = Players.LocalPlayer
local playerGui = localPlayer:WaitForChild("PlayerGui")

-- 创建主屏幕 GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CatKingSpeedGUI"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false

-- 创建左上角标题
local titleLabel = Instance.new("TextLabel")
titleLabel.Name = "CatKingTitle"
titleLabel.Size = UDim2.new(0, 150, 0, 40)
titleLabel.Position = UDim2.new(0, 10, 0, 10)
titleLabel.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
titleLabel.BackgroundTransparency = 0.3
titleLabel.BorderSizePixel = 0
titleLabel.Text = "猫帝SPEED"
titleLabel.TextColor3 = Color3.fromRGB(255, 165, 0)
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 18
titleLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
titleLabel.TextStrokeTransparency = 0
titleLabel.Parent = screenGui

-- 添加圆角
local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 6)
titleCorner.Parent = titleLabel

-- 创建主框架
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 300, 0, 250)
mainFrame.Position = UDim2.new(0, 10, 0, 60)
mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
mainFrame.BackgroundTransparency = 0.2
mainFrame.BorderSizePixel = 0
mainFrame.ClipsDescendants = true
mainFrame.Parent = screenGui

-- 添加圆角
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = mainFrame

-- 创建标题栏
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 30)
titleBar.Position = UDim2.new(0, 0, 0, 0)
titleBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

local titleBarCorner = Instance.new("UICorner")
titleBarCorner.CornerRadius = UDim.new(0, 8)
titleBarCorner.Parent = titleBar

local title = Instance.new("TextLabel")
title.Name = "Title"
title.Size = UDim2.new(1, -40, 1, 0)
title.Position = UDim2.new(0, 10, 0, 0)
title.BackgroundTransparency = 1
title.Text = "慢速加速控制"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextXAlignment = Enum.TextXAlignment.Left
title.Font = Enum.Font.GothamBold
title.TextSize = 14
title.Parent = titleBar

-- 关闭按钮
local closeButton = Instance.new("TextButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(1, -30, 0, 0)
closeButton.BackgroundTransparency = 1
closeButton.Text = "X"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 14
closeButton.Parent = titleBar

-- 创建内容区域
local contentFrame = Instance.new("Frame")
contentFrame.Name = "ContentFrame"
contentFrame.Size = UDim2.new(1, -20, 1, -50)
contentFrame.Position = UDim2.new(0, 10, 0, 40)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

-- 加速开关按钮
local speedToggle = Instance.new("TextButton")
speedToggle.Name = "SpeedToggle"
speedToggle.Size = UDim2.new(1, 0, 0, 40)
speedToggle.Position = UDim2.new(0, 0, 0, 0)
speedToggle.BackgroundColor3 = Color3.fromRGB(120, 60, 60)
speedToggle.BorderSizePixel = 0
speedToggle.Text = "慢速加速: 关闭"
speedToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
speedToggle.Font = Enum.Font.Gotham
speedToggle.TextSize = 14
speedToggle.Parent = contentFrame

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 6)
toggleCorner.Parent = speedToggle

-- 基础速度设置
local baseSpeedLabel = Instance.new("TextLabel")
baseSpeedLabel.Name = "BaseSpeedLabel"
baseSpeedLabel.Size = UDim2.new(0.6, 0, 0, 20)
baseSpeedLabel.Position = UDim2.new(0, 0, 0, 50)
baseSpeedLabel.BackgroundTransparency = 1
baseSpeedLabel.Text = "基础速度: 16"
baseSpeedLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
baseSpeedLabel.Font = Enum.Font.Gotham
baseSpeedLabel.TextSize = 12
baseSpeedLabel.TextXAlignment = Enum.TextXAlignment.Left
baseSpeedLabel.Parent = contentFrame

local baseSpeedSlider = Instance.new("Frame")
baseSpeedSlider.Name = "BaseSpeedSlider"
baseSpeedSlider.Size = UDim2.new(0.4, 0, 0, 10)
baseSpeedSlider.Position = UDim2.new(0.6, 0, 0, 55)
baseSpeedSlider.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
baseSpeedSlider.BorderSizePixel = 0
baseSpeedSlider.Parent = contentFrame

local baseSliderCorner = Instance.new("UICorner")
baseSliderCorner.CornerRadius = UDim.new(0, 5)
baseSliderCorner.Parent = baseSpeedSlider

local baseSliderFill = Instance.new("Frame")
baseSliderFill.Name = "BaseSliderFill"
baseSliderFill.Size = UDim2.new(0.5, 0, 1, 0)
baseSliderFill.Position = UDim2.new(0, 0, 0, 0)
baseSliderFill.BackgroundColor3 = Color3.fromRGB(0, 150, 100)
baseSliderFill.BorderSizePixel = 0
baseSliderFill.Parent = baseSpeedSlider

local baseFillCorner = Instance.new("UICorner")
baseFillCorner.CornerRadius = UDim.new(0, 5)
baseFillCorner.Parent = baseSliderFill

-- 最大速度设置
local maxSpeedLabel = Instance.new("TextLabel")
maxSpeedLabel.Name = "MaxSpeedLabel"
maxSpeedLabel.Size = UDim2.new(0.6, 0, 0, 20)
maxSpeedLabel.Position = UDim2.new(0, 0, 0, 75)
maxSpeedLabel.BackgroundTransparency = 1
maxSpeedLabel.Text = "最大速度: 30"
maxSpeedLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
maxSpeedLabel.Font = Enum.Font.Gotham
maxSpeedLabel.TextSize = 12
maxSpeedLabel.TextXAlignment = Enum.TextXAlignment.Left
maxSpeedLabel.Parent = contentFrame

local maxSpeedSlider = Instance.new("Frame")
maxSpeedSlider.Name = "MaxSpeedSlider"
maxSpeedSlider.Size = UDim2.new(0.4, 0, 0, 10)
maxSpeedSlider.Position = UDim2.new(0.6, 0, 0, 80)
maxSpeedSlider.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
maxSpeedSlider.BorderSizePixel = 0
maxSpeedSlider.Parent = contentFrame

local maxSliderCorner = Instance.new("UICorner")
maxSliderCorner.CornerRadius = UDim.new(0, 5)
maxSliderCorner.Parent = maxSpeedSlider

local maxSliderFill = Instance.new("Frame")
maxSliderFill.Name = "MaxSliderFill"
maxSliderFill.Size = UDim2.new(0.5, 0, 1, 0)
maxSliderFill.Position = UDim2.new(0, 0, 0, 0)
maxSliderFill.BackgroundColor3 = Color3.fromRGB(150, 0, 100)
maxSliderFill.BorderSizePixel = 0
maxSliderFill.Parent = maxSpeedSlider

local maxFillCorner = Instance.new("UICorner")
maxFillCorner.CornerRadius = UDim.new(0, 5)
maxFillCorner.Parent = maxSliderFill

-- 加速速率设置
local accelerationLabel = Instance.new("TextLabel")
accelerationLabel.Name = "AccelerationLabel"
accelerationLabel.Size = UDim2.new(0.6, 0, 0, 20)
accelerationLabel.Position = UDim2.new(0, 0, 0, 100)
accelerationLabel.BackgroundTransparency = 1
accelerationLabel.Text = "加速速率: 0.5"
accelerationLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
accelerationLabel.Font = Enum.Font.Gotham
accelerationLabel.TextSize = 12
accelerationLabel.TextXAlignment = Enum.TextXAlignment.Left
accelerationLabel.Parent = contentFrame

local accelerationSlider = Instance.new("Frame")
accelerationSlider.Name = "AccelerationSlider"
accelerationSlider.Size = UDim2.new(0.4, 0, 0, 10)
accelerationSlider.Position = UDim2.new(0.6, 0, 0, 105)
accelerationSlider.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
accelerationSlider.BorderSizePixel = 0
accelerationSlider.Parent = contentFrame

local accelSliderCorner = Instance.new("UICorner")
accelSliderCorner.CornerRadius = UDim.new(0, 5)
accelSliderCorner.Parent = accelerationSlider

local accelSliderFill = Instance.new("Frame")
accelSliderFill.Name = "AccelSliderFill"
accelSliderFill.Size = UDim2.new(0.5, 0, 1, 0)
accelSliderFill.Position = UDim2.new(0, 0, 0, 0)
accelSliderFill.BackgroundColor3 = Color3.fromRGB(200, 150, 0)
accelSliderFill.BorderSizePixel = 0
accelSliderFill.Parent = accelerationSlider

local accelFillCorner = Instance.new("UICorner")
accelFillCorner.CornerRadius = UDim.new(0, 5)
accelFillCorner.Parent = accelSliderFill

-- 状态显示
local statusLabel = Instance.new("TextLabel")
statusLabel.Name = "StatusLabel"
statusLabel.Size = UDim2.new(1, 0, 0, 30)
statusLabel.Position = UDim2.new(0, 0, 0, 125)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "当前速度: 16 (基础)"
statusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextSize = 12
statusLabel.Parent = contentFrame

-- 提示文本
local hintLabel = Instance.new("TextLabel")
hintLabel.Name = "HintLabel"
hintLabel.Size = UDim2.new(1, 0, 0, 50)
hintLabel.Position = UDim2.new(0, 0, 0, 160)
hintLabel.BackgroundTransparency = 1
hintLabel.Text = "提示: 按住 Shift 键加速，松开后缓慢减速\nF - 隐藏/显示面板 | C - 切换加速"
hintLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
hintLabel.Font = Enum.Font.Gotham
hintLabel.TextSize = 11
hintLabel.TextWrapped = true
hintLabel.Parent = contentFrame

-- 拖拽功能
local dragging = false
local dragInput, dragStart, startPos

titleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

titleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- 关闭按钮功能
closeButton.MouseButton1Click:Connect(function()
    if speedEnabled then
        toggleSpeed()
    end
    screenGui:Destroy()
end)

-- 按钮悬停效果
local function buttonHoverEffect(button)
    button.MouseEnter:Connect(function()
        TweenService:Create(
            button,
            TweenInfo.new(0.2),
            {BackgroundColor3 = Color3.fromRGB(140, 140, 140)}
        ):Play()
    end)
    
    button.MouseLeave:Connect(function()
        if speedEnabled then
            TweenService:Create(
                button,
                TweenInfo.new(0.2),
                {BackgroundColor3 = Color3.fromRGB(60, 120, 60)}
            ):Play()
        else
            TweenService:Create(
                button,
                TweenInfo.new(0.2),
                {BackgroundColor3 = Color3.fromRGB(120, 60, 60)}
            ):Play()
        end
    end)
end

buttonHoverEffect(speedToggle)

-- 速度控制变量
local speedEnabled = false
local baseSpeed = 16
local maxSpeed = 30
local accelerationRate = 0.5
local currentSpeed = baseSpeed
local character
local humanoid
local speedConnection

-- 初始化人物
local function initializeCharacter()
    character = localPlayer.Character or localPlayer.CharacterAdded:Wait()
    humanoid = character:WaitForChild("Humanoid")
    
    -- 设置基础速度
    humanoid.WalkSpeed = baseSpeed
    currentSpeed = baseSpeed
    statusLabel.Text = "当前速度: " .. math.floor(currentSpeed) .. " (基础)"
    
    -- 监听人物死亡
    humanoid.Died:Connect(function()
        if speedEnabled then
            toggleSpeed()
        end
    end)
end

-- 初始化
if localPlayer.Character then
    initializeCharacter()
end
localPlayer.CharacterAdded:Connect(initializeCharacter)

-- 速度控制功能
local function toggleSpeed()
    if not humanoid or humanoid.Health <= 0 then
        return
    end
    
    speedEnabled = not speedEnabled
    
    if speedEnabled then
        -- 启用加速
        statusLabel.Text = "当前速度: " .. math.floor(currentSpeed) .. " (加速中)"
        speedToggle.Text = "慢速加速: 开启"
        speedToggle.BackgroundColor3 = Color3.fromRGB(60, 120, 60)
        titleLabel.Text = "猫帝SPEED [开启]"
        
        -- 创建速度控制循环
        if speedConnection then
            speedConnection:Disconnect()
        end
        
        speedConnection = RunService.Heartbeat:Connect(function(deltaTime)
            if speedEnabled and humanoid and humanoid.Health > 0 then
                -- 检查是否按下Shift键
                local isSprinting = UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) or 
                                   UserInputService:IsKeyDown(Enum.KeyCode.RightShift)
                
                if isSprinting then
                    -- 缓慢加速
                    currentSpeed = math.min(currentSpeed + accelerationRate * deltaTime * 10, maxSpeed)
                else
                    -- 缓慢减速
                    currentSpeed = math.max(currentSpeed - accelerationRate * deltaTime * 5, baseSpeed)
                end
                
                -- 应用速度
                humanoid.WalkSpeed = currentSpeed
                
                -- 更新状态显示
                if isSprinting then
                    statusLabel.Text = "当前速度: " .. math.floor(currentSpeed) .. " (加速中)"
                else
                    statusLabel.Text = "当前速度: " .. math.floor(currentSpeed) .. " (减速中)"
                end
            end
        end)
        
    else
        -- 禁用加速
        statusLabel.Text = "当前速度: " .. math.floor(baseSpeed) .. " (基础)"
        speedToggle.Text = "慢速加速: 关闭"
        speedToggle.BackgroundColor3 = Color3.fromRGB(120, 60, 60)
        titleLabel.Text = "猫帝SPEED [关闭]"
        
        -- 恢复基础速度
        currentSpeed = baseSpeed
        humanoid.WalkSpeed = baseSpeed
        
        -- 断开连接
        if speedConnection then
            speedConnection:Disconnect()
            speedConnection = nil
        end
    end
end

-- 按钮点击事件
speedToggle.MouseButton1Click:Connect(toggleSpeed)

-- C键快速切换加速
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.C then
        toggleSpeed()
    end
end)

-- F键显示/隐藏控制面板
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.F then
        mainFrame.Visible = not mainFrame.Visible
    end
end)

-- 滑块功能
local function setupSlider(slider, fill, label, minValue, maxValue, currentValue, callback)
    local dragging = false
    
    slider.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
        end
    end)
    
    slider.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local xPos = math.clamp(input.Position.X - slider.AbsolutePosition.X, 0, slider.AbsoluteSize.X)
            local percent = xPos / slider.AbsoluteSize.X
            
            fill.Size = UDim2.new(percent, 0, 1, 0)
            local value = math.floor(minValue + percent * (maxValue - minValue))
            
            if callback then
                callback(value)
            else
                label.Text = label.Name .. ": " .. value
            end
        end
    end)
end

-- 基础速度滑块
setupSlider(baseSpeedSlider, baseSliderFill, baseSpeedLabel, 5, 30, baseSpeed, function(value)
    baseSpeed = value
    baseSpeedLabel.Text = "基础速度: " .. baseSpeed
    
    if not speedEnabled then
        currentSpeed = baseSpeed
        if humanoid then
            humanoid.WalkSpeed = baseSpeed
        end
        statusLabel.Text = "当前速度: " .. math.floor(currentSpeed) .. " (基础)"
    end
end)

-- 最大速度滑块
setupSlider(maxSpeedSlider, maxSliderFill, maxSpeedLabel, 20, 100, maxSpeed, function(value)
    maxSpeed = value
    maxSpeedLabel.Text = "最大速度: " .. maxSpeed
end)

-- 加速速率滑块
setupSlider(accelerationSlider, accelSliderFill, accelerationLabel, 0.1, 2.0, accelerationRate, function(value)
    accelerationRate = math.floor(value * 10) / 10 -- 保留一位小数
    accelerationLabel.Text = "加速速率: " .. accelerationRate
end)

-- 初始化滑块位置
baseSliderFill.Size = UDim2.new((baseSpeed - 5) / 25, 0, 1, 0)
maxSliderFill.Size = UDim2.new((maxSpeed - 20) / 80, 0, 1, 0)
accelSliderFill.Size = UDim2.new((accelerationRate - 0.1) / 1.9, 0, 1, 0)

-- 自动重新应用速度当角色重新生成时
localPlayer.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    humanoid = newCharacter:WaitForChild("Humanoid")
    
    if speedEnabled then
        -- 等待角色完全加载
        wait(1)
        
        -- 重新应用速度
        humanoid.WalkSpeed = currentSpeed
        
        statusLabel.Text = "当前速度: " .. math.floor(currentSpeed) .. " (加速中)"
        speedToggle.Text = "慢速加速: 开启"
        speedToggle.BackgroundColor3 = Color3.fromRGB(60, 120, 60)
        titleLabel.Text = "猫帝SPEED [开启]"
    else
        humanoid.WalkSpeed = baseSpeed
        currentSpeed = baseSpeed
        statusLabel.Text = "当前速度: " .. math.floor(currentSpeed) .. " (基础)"
    end
end)
